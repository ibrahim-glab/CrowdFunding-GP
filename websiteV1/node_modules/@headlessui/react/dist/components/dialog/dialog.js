import g,{createContext as le,createRef as ne,useContext as V,useEffect as k,useMemo as b,useReducer as ae,useRef as H,useState as ie}from"react";import{match as M}from'../../utils/match.js';import{forwardRefWithAs as A,render as O,Features as K}from'../../utils/render.js';import{useSyncRefs as C}from'../../hooks/use-sync-refs.js';import{Keys as se}from'../keyboard.js';import{isDisabledReactIssue7711 as de}from'../../utils/bugs.js';import{useId as S}from'../../hooks/use-id.js';import{FocusTrap as L}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as pe}from'../../hooks/use-inert-others.js';import{Portal as W}from'../../components/portal/portal.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{Description as ue,useDescriptions as fe}from'../description/description.js';import{useOpenClosed as ce,State as q}from'../../internal/open-closed.js';import{useServerHandoffComplete as ge}from'../../hooks/use-server-handoff-complete.js';import{StackProvider as Te,StackMessage as z}from'../../internal/stack-context.js';import{useOutsideClick as me}from'../../hooks/use-outside-click.js';import{useOwnerDocument as De}from'../../hooks/use-owner.js';import{useEventListener as Pe}from'../../hooks/use-event-listener.js';import{Hidden as ye,Features as Re}from'../../internal/hidden.js';import{useEvent as h}from'../../hooks/use-event.js';import{disposables as Ee}from'../../utils/disposables.js';import{isIOS as ve}from'../../utils/platform.js';var be=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(be||{}),he=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(he||{});let Ae={[0](r,e){return r.titleId===e.id?r:{...r,titleId:e.id}}},I=le(null);I.displayName="DialogContext";function w(r){let e=V(I);if(e===null){let t=new Error(`<${r} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,w),t}return e}function Oe(r,e,t=()=>[document.body]){k(()=>{var u;if(!e||!r)return;let d=Ee();function i(l,n,D){let p=l.style.getPropertyValue(n);return Object.assign(l.style,{[n]:D}),d.add(()=>{Object.assign(l.style,{[n]:p})})}let o=r.documentElement,s=((u=r.defaultView)!=null?u:window).innerWidth-o.clientWidth;if(i(o,"overflow","hidden"),s>0){let l=o.clientWidth-o.offsetWidth,n=s-l;i(o,"paddingRight",`${n}px`)}if(ve()){let l=window.pageYOffset;i(document.body,"marginTop",`-${l}px`),window.scrollTo(0,0),d.addEventListener(r,"touchmove",n=>{n.target instanceof HTMLElement&&!t().some(D=>D.contains(n.target))&&n.preventDefault()},{passive:!1}),d.add(()=>{window.scrollTo(0,window.pageYOffset+l)})}return d.dispose},[r,e])}function Ce(r,e){return M(e.type,Ae,r,e)}let Se="div",Le=K.RenderStrategy|K.Static,we=A(function(e,t){let d=S(),{id:i=`headlessui-dialog-${d}`,open:o,onClose:a,initialFocus:s,__demoMode:u=!1,...l}=e,[n,D]=ie(0),p=ce();o===void 0&&p!==null&&(o=M(p,{[q.Open]:!0,[q.Closed]:!1}));let _=H(new Set),m=H(null),J=C(m,t),G=H(null),P=De(m),U=e.hasOwnProperty("open")||p!==null,$=e.hasOwnProperty("onClose");if(!U&&!$)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!U)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!$)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof o!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${o}`);if(typeof a!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${a}`);let f=o?0:1,[R,Q]=ae(Ce,{titleId:null,descriptionId:null,panelRef:ne()}),E=h(()=>a(!1)),Y=h(c=>Q({type:0,id:c})),x=ge()?u?!1:f===0:!1,F=n>1,X=V(I)!==null,Z=F?"parent":"leaf";pe(m,F?x:!1);let j=h(()=>{var v,T;return[...Array.from((v=P==null?void 0:P.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?v:[]).filter(y=>!(!(y instanceof HTMLElement)||y.contains(G.current)||R.panelRef.current&&y.contains(R.panelRef.current))),(T=R.panelRef.current)!=null?T:m.current]});me(()=>j(),E,x&&!F),Pe(P==null?void 0:P.defaultView,"keydown",c=>{c.defaultPrevented||c.key===se.Escape&&f===0&&(F||(c.preventDefault(),c.stopPropagation(),E()))}),Oe(P,f===0&&!X,j),k(()=>{if(f!==0||!m.current)return;let c=new IntersectionObserver(v=>{for(let T of v)T.boundingClientRect.x===0&&T.boundingClientRect.y===0&&T.boundingClientRect.width===0&&T.boundingClientRect.height===0&&E()});return c.observe(m.current),()=>c.disconnect()},[f,m,E]);let[ee,te]=fe(),oe=b(()=>[{dialogState:f,close:E,setTitleId:Y},R],[f,R,E,Y]),N=b(()=>({open:f===0}),[f]),re={ref:J,id:i,role:"dialog","aria-modal":f===0?!0:void 0,"aria-labelledby":R.titleId,"aria-describedby":ee};return g.createElement(Te,{type:"Dialog",enabled:f===0,element:m,onUpdate:h((c,v,T)=>{v==="Dialog"&&M(c,{[z.Add](){_.current.add(T),D(y=>y+1)},[z.Remove](){_.current.add(T),D(y=>y-1)}})})},g.createElement(B,{force:!0},g.createElement(W,null,g.createElement(I.Provider,{value:oe},g.createElement(W.Group,{target:m},g.createElement(B,{force:!1},g.createElement(te,{slot:N,name:"Dialog.Description"},g.createElement(L,{initialFocus:s,containers:_,features:x?M(Z,{parent:L.features.RestoreFocus,leaf:L.features.All&~L.features.FocusLock}):L.features.None},O({ourProps:re,theirProps:l,slot:N,defaultTag:Se,features:Le,visible:f===0,name:"Dialog"})))))))),g.createElement(ye,{features:Re.Hidden,ref:G}))}),Fe="div",ke=A(function(e,t){let d=S(),{id:i=`headlessui-dialog-overlay-${d}`,...o}=e,[{dialogState:a,close:s}]=w("Dialog.Overlay"),u=C(t),l=h(p=>{if(p.target===p.currentTarget){if(de(p.currentTarget))return p.preventDefault();p.preventDefault(),p.stopPropagation(),s()}}),n=b(()=>({open:a===0}),[a]);return O({ourProps:{ref:u,id:i,"aria-hidden":!0,onClick:l},theirProps:o,slot:n,defaultTag:Fe,name:"Dialog.Overlay"})}),Me="div",Ie=A(function(e,t){let d=S(),{id:i=`headlessui-dialog-backdrop-${d}`,...o}=e,[{dialogState:a},s]=w("Dialog.Backdrop"),u=C(t);k(()=>{if(s.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[s.panelRef]);let l=b(()=>({open:a===0}),[a]);return g.createElement(B,{force:!0},g.createElement(W,null,O({ourProps:{ref:u,id:i,"aria-hidden":!0},theirProps:o,slot:l,defaultTag:Me,name:"Dialog.Backdrop"})))}),_e="div",xe=A(function(e,t){let d=S(),{id:i=`headlessui-dialog-panel-${d}`,...o}=e,[{dialogState:a},s]=w("Dialog.Panel"),u=C(t,s.panelRef),l=b(()=>({open:a===0}),[a]),n=h(p=>{p.stopPropagation()});return O({ourProps:{ref:u,id:i,onClick:n},theirProps:o,slot:l,defaultTag:_e,name:"Dialog.Panel"})}),He="h2",We=A(function(e,t){let d=S(),{id:i=`headlessui-dialog-title-${d}`,...o}=e,[{dialogState:a,setTitleId:s}]=w("Dialog.Title"),u=C(t);k(()=>(s(i),()=>s(null)),[i,s]);let l=b(()=>({open:a===0}),[a]);return O({ourProps:{ref:u,id:i},theirProps:o,slot:l,defaultTag:He,name:"Dialog.Title"})}),mt=Object.assign(we,{Backdrop:Ie,Panel:xe,Overlay:ke,Title:We,Description:ue});export{mt as Dialog};

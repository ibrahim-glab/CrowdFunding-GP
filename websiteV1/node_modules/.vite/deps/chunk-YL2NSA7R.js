import {
  FormField,
  HeadlessConnectUI,
  WalletSelection,
  defaultWallets,
  safeChainIdToSlug,
  safeSlugToChainId
} from "./chunk-W7GOXLRJ.js";
import {
  Button,
  ChevronDownIcon,
  Container,
  ExclamationTriangleIcon,
  Label,
  Line,
  Link,
  ModalConfigCtx,
  ModalDescription,
  ModalHeader,
  ScreenBottomContainer,
  Spacer,
  Spinner,
  StyledSelect,
  Text,
  fontSize,
  iconSize,
  newStyled,
  spacing,
  useCustomTheme,
  useDisconnect,
  useSupportedChains,
  useTWLocale,
  useWalletContext
} from "./chunk-NYGIGPQ5.js";
import {
  SafeWallet
} from "./chunk-QE3TBV5F.js";
import {
  walletIds
} from "./chunk-7WSDJM3S.js";
import {
  require_browser
} from "./chunk-B6AWC6WQ.js";
import {
  init_lib7 as init_lib,
  utils_exports
} from "./chunk-WYHBVST3.js";
import {
  init_es
} from "./chunk-US46ZGV2.js";
import {
  require_jsx_runtime
} from "./chunk-VVPHE36V.js";
import {
  require_react
} from "./chunk-JTDWFPTU.js";
import {
  __toESM
} from "./chunk-HY2WJTHE.js";

// node_modules/@thirdweb-dev/react/dist/safeWallet-518bf0ea.browser.esm.js
var import_react = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());
init_lib();
init_es();
var import_qrcode = __toESM(require_browser());
var SelectpersonalWallet = (props) => {
  const twLocale = useTWLocale();
  const locale = twLocale.wallets.safeWallet;
  const guestWallet = props.personalWallets.find((w) => w.id === walletIds.localWallet);
  const personalWallets = props.personalWallets.filter((w) => w.id !== walletIds.localWallet);
  const {
    personalWalletConnection
  } = useWalletContext();
  const {
    selectWallet
  } = props;
  const selected = (0, import_react.useRef)(false);
  (0, import_react.useEffect)(() => {
    if (selected.current) {
      return;
    }
    if (guestWallet && personalWallets.length === 0) {
      selected.current = true;
      selectWallet(guestWallet);
    }
  }, [guestWallet, personalWallets.length, selectWallet]);
  if (guestWallet && personalWallets.length === 0) {
    return (0, import_jsx_runtime.jsx)("div", {
      style: {
        height: "250px"
      }
    });
  }
  return (0, import_jsx_runtime.jsxs)(Container, {
    flex: "column",
    scrollY: true,
    animate: "fadein",
    children: [(0, import_jsx_runtime.jsx)(Container, {
      p: "lg",
      children: (0, import_jsx_runtime.jsx)(ModalHeader, {
        title: props.safeWallet.meta.name,
        onBack: props.renderBackButton ? props.onBack : void 0,
        imgSrc: props.safeWallet.meta.iconURL
      })
    }), (0, import_jsx_runtime.jsx)(Line, {}), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "sm"
    }), (0, import_jsx_runtime.jsxs)(Container, {
      px: "lg",
      children: [(0, import_jsx_runtime.jsx)(Spacer, {
        y: "md"
      }), (0, import_jsx_runtime.jsx)(Text, {
        size: "lg",
        color: "primaryText",
        weight: 500,
        children: locale.connectWalletScreen.title
      }), (0, import_jsx_runtime.jsx)(Spacer, {
        y: "sm"
      }), (0, import_jsx_runtime.jsxs)(Text, {
        multiline: true,
        children: [locale.connectWalletScreen.subtitle, " ", (0, import_jsx_runtime.jsx)(Link, {
          inline: true,
          target: "_blank",
          href: "https://docs.safe.global/getting-started/readme",
          style: {
            whiteSpace: "nowrap"
          },
          children: locale.connectWalletScreen.learnMoreLink
        }), " "]
      })]
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "lg"
    }), (0, import_jsx_runtime.jsx)(Container, {
      expand: true,
      px: "md",
      scrollY: true,
      children: (0, import_jsx_runtime.jsx)(WalletSelection, {
        maxHeight: "300px",
        walletConfigs: personalWallets,
        selectWallet: props.selectWallet,
        selectUIProps: {
          connect: personalWalletConnection.connectWallet,
          connectionStatus: personalWalletConnection.connectionStatus,
          createWalletInstance: personalWalletConnection.createWalletInstance,
          setConnectedWallet: personalWalletConnection.setConnectedWallet,
          setConnectionStatus: personalWalletConnection.setConnectionStatus,
          connectedWallet: personalWalletConnection.activeWallet,
          connectedWalletAddress: personalWalletConnection.address
        }
      })
    }), guestWallet && (0, import_jsx_runtime.jsx)(ScreenBottomContainer, {
      children: (0, import_jsx_runtime.jsx)(Button, {
        variant: "link",
        fullWidth: true,
        onClick: () => {
          props.selectWallet(guestWallet);
        },
        "data-test": "continue-as-guest-button",
        children: twLocale.connectWallet.continueAsGuest
      })
    })]
  });
};
var SelectAccount = (props) => {
  const locale = useTWLocale().wallets.safeWallet.accountDetailsScreen;
  const {
    personalWalletConnection
  } = useWalletContext();
  const {
    activeWallet,
    chainId,
    switchChain
  } = personalWalletConnection;
  const {
    connect,
    connectionStatus
  } = props;
  const [safeAddress, setSafeAddress] = (0, import_react.useState)("");
  const [safeChainId, setSafeChainId] = (0, import_react.useState)(-1);
  const [safeConnectError, setSafeConnectError] = (0, import_react.useState)(false);
  const [switchError, setSwitchError] = (0, import_react.useState)(false);
  const [switchingNetwork, setSwitchingNetwork] = (0, import_react.useState)(false);
  const chains = useSupportedChains();
  const supportedChains = chains.filter((c) => c.chainId in safeChainIdToSlug);
  const selectedSafeChain = supportedChains.find((c) => c.chainId === safeChainId);
  const testnets = supportedChains.filter((c) => c.testnet);
  const mainnets = supportedChains.filter((c) => !c.testnet);
  const useOptGroup = mainnets.length > 0 && testnets.length > 0;
  const handleSubmit = async () => {
    if (!selectedSafeChain || !activeWallet) {
      return;
    }
    setSafeConnectError(false);
    try {
      await connect({
        chain: selectedSafeChain,
        personalWallet: activeWallet,
        safeAddress
      });
      props.onConnect();
    } catch (e) {
      console.error(e);
      setSafeConnectError(true);
    }
  };
  const mismatch = safeChainId !== -1 && chainId !== safeChainId;
  const isValidAddress = utils_exports.isAddress(safeAddress);
  const disableNetworkSelection = supportedChains.length === 1;
  const modalConfig = (0, import_react.useContext)(ModalConfigCtx);
  return (0, import_jsx_runtime.jsx)(Container, {
    fullHeight: true,
    flex: "column",
    scrollY: true,
    children: (0, import_jsx_runtime.jsxs)("form", {
      style: {
        height: "100%",
        display: "flex",
        flexDirection: "column"
      },
      onSubmit: (e) => {
        e.preventDefault();
        handleSubmit();
      },
      children: [(0, import_jsx_runtime.jsx)(Container, {
        p: "lg",
        children: (0, import_jsx_runtime.jsx)(ModalHeader, {
          title: props.meta.name,
          onBack: props.renderBackButton ? props.onBack : void 0,
          imgSrc: props.meta.iconURL
        })
      }), (0, import_jsx_runtime.jsx)(Line, {}), (0, import_jsx_runtime.jsxs)(Container, {
        expand: true,
        flex: "column",
        p: "lg",
        scrollY: true,
        style: {
          paddingTop: 0
        },
        children: [(0, import_jsx_runtime.jsx)(Spacer, {
          y: "xl"
        }), (0, import_jsx_runtime.jsx)(Text, {
          color: "primaryText",
          size: "lg",
          weight: 500,
          children: locale.title
        }), (0, import_jsx_runtime.jsx)(Spacer, {
          y: "sm"
        }), (0, import_jsx_runtime.jsxs)(ModalDescription, {
          children: [locale.findSafeAddressIn, " ", (0, import_jsx_runtime.jsx)(Link, {
            inline: true,
            target: "_blank",
            href: "https://app.safe.global/home",
            style: {
              display: "inline",
              whiteSpace: "nowrap"
            },
            children: locale.dashboardLink
          })]
        }), (0, import_jsx_runtime.jsx)(Spacer, {
          y: "xl"
        }), (0, import_jsx_runtime.jsx)(FormField, {
          name: "safeAddress",
          id: "safeAddress",
          errorMessage: safeAddress && !isValidAddress ? "Invalid Safe Address" : void 0,
          autocomplete: "on",
          onChange: (value) => {
            setSafeConnectError(false);
            if (value.length > 4) {
              const prefix = value.split(":")[0];
              const _chainId = prefix && prefix in safeSlugToChainId ? safeSlugToChainId[prefix] : void 0;
              if (_chainId && prefix) {
                setSafeChainId(_chainId);
                setSafeAddress(value.slice(prefix.length + 1));
              } else {
                setSafeAddress(value);
              }
            } else {
              setSafeAddress(value);
            }
          },
          label: locale.safeAddress,
          type: "text",
          value: safeAddress,
          required: true,
          placeholder: "0x123..."
        }), (0, import_jsx_runtime.jsx)(Spacer, {
          y: "lg"
        }), (0, import_jsx_runtime.jsx)(Label, {
          htmlFor: "safeNetwork",
          children: locale.network
        }), (0, import_jsx_runtime.jsx)(Spacer, {
          y: "sm"
        }), (0, import_jsx_runtime.jsxs)("div", {
          style: {
            position: "relative"
          },
          children: [(0, import_jsx_runtime.jsxs)(NetworkSelect, {
            "data-error": supportedChains.length === 0 || safeConnectError,
            required: true,
            name: "safeNetwork",
            id: "safeNetwork",
            value: safeChainId,
            disabled: disableNetworkSelection,
            placeholder: locale.selectNetworkPlaceholder,
            onChange: (e) => {
              setSafeConnectError(false);
              setSwitchError(false);
              setSafeChainId(Number(e.target.value));
            },
            children: [!disableNetworkSelection && (0, import_jsx_runtime.jsx)("option", {
              value: "",
              hidden: true,
              children: locale.selectNetworkPlaceholder
            }), useOptGroup ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
              children: [(0, import_jsx_runtime.jsx)("optgroup", {
                label: locale.mainnets,
                children: mainnets.map((chain) => {
                  return (0, import_jsx_runtime.jsx)("option", {
                    value: chain.chainId,
                    children: chain.name
                  }, chain.chainId);
                })
              }), (0, import_jsx_runtime.jsx)("optgroup", {
                label: locale.testnets,
                children: testnets.map((chain) => {
                  return (0, import_jsx_runtime.jsx)("option", {
                    value: chain.chainId,
                    children: chain.name
                  }, chain.chainId);
                })
              })]
            }) : supportedChains.map((chain) => {
              return (0, import_jsx_runtime.jsx)("option", {
                value: chain.chainId,
                children: chain.name
              }, chain.chainId);
            })]
          }), !disableNetworkSelection && (0, import_jsx_runtime.jsx)(StyledChevronDownIcon, {
            width: iconSize.sm,
            height: iconSize.sm,
            style: {
              position: "absolute",
              top: "50%",
              right: spacing.sm,
              transform: "translateY(-50%)",
              pointerEvents: "none"
            }
          })]
        }), (0, import_jsx_runtime.jsx)(Spacer, {
          y: "sm"
        }), supportedChains.length === 0 && (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
          children: [(0, import_jsx_runtime.jsxs)(Text, {
            color: "danger",
            multiline: true,
            size: "xs",
            children: [" ", locale.invalidChainConfig]
          }), (0, import_jsx_runtime.jsx)(Spacer, {
            y: "sm"
          })]
        }), safeConnectError && (0, import_jsx_runtime.jsxs)(Text, {
          size: "xs",
          multiline: true,
          color: "danger",
          style: {
            display: "flex",
            gap: spacing.sm,
            alignItems: "center"
          },
          children: [(0, import_jsx_runtime.jsx)(ExclamationTriangleIcon, {
            width: iconSize.sm,
            height: iconSize.sm
          }), (0, import_jsx_runtime.jsx)("span", {
            children: locale.failedToConnect
          })]
        }), switchError && (0, import_jsx_runtime.jsx)(Text, {
          color: "danger",
          size: "sm",
          children: (0, import_jsx_runtime.jsxs)(Container, {
            flex: "row",
            gap: "sm",
            center: "y",
            children: [(0, import_jsx_runtime.jsx)(ExclamationTriangleIcon, {
              width: iconSize.sm,
              height: iconSize.sm
            }), locale.failedToSwitch]
          })
        })]
      }), (0, import_jsx_runtime.jsx)(Container, {
        p: "lg",
        flex: "row",
        style: {
          paddingTop: 0,
          justifyContent: "flex-end"
        },
        children: mismatch ? (0, import_jsx_runtime.jsxs)(Button, {
          type: "button",
          variant: "primary",
          style: {
            display: "flex",
            alignItems: "center",
            gap: spacing.sm,
            width: modalConfig.modalSize === "compact" ? "100%" : void 0
          },
          onClick: async () => {
            if (!activeWallet) {
              throw new Error("No active wallet");
            }
            setSafeConnectError(false);
            setSwitchError(false);
            setSwitchingNetwork(true);
            try {
              await switchChain(safeChainId);
            } catch (e) {
              setSwitchError(true);
            } finally {
              setSwitchingNetwork(false);
            }
          },
          children: [" ", switchingNetwork ? locale.switchingNetwork : locale.switchNetwork, switchingNetwork && (0, import_jsx_runtime.jsx)(Spinner, {
            size: "sm",
            color: "primaryButtonText"
          })]
        }) : (0, import_jsx_runtime.jsxs)(Button, {
          variant: "accent",
          type: "submit",
          disabled: connectionStatus === "connecting",
          style: {
            display: "flex",
            alignItems: "center",
            gap: spacing.sm,
            width: modalConfig.modalSize === "compact" ? "100%" : void 0
          },
          children: [connectionStatus === "connecting" ? locale.connecting : locale.connectToSafe, connectionStatus === "connecting" && (0, import_jsx_runtime.jsx)(Spinner, {
            size: "sm",
            color: "accentButtonText"
          })]
        })
      })]
    })
  });
};
var NetworkSelect = StyledSelect(() => {
  const theme = useCustomTheme();
  return {
    width: "100%",
    padding: spacing.sm,
    boxSizing: "border-box",
    outline: "none",
    border: "none",
    borderRadius: "6px",
    color: theme.colors.primaryText,
    background: "none",
    fontSize: fontSize.md,
    boxShadow: `0 0 0 1.5px ${theme.colors.secondaryButtonBg}`,
    appearance: "none",
    "&:focus": {
      boxShadow: `0 0 0 2px ${theme.colors.accentText}`
    },
    "&:invalid": {
      color: theme.colors.secondaryText
    },
    "&[data-error='true']": {
      boxShadow: `0 0 0 1.5px ${theme.colors.danger}`
    },
    "&[disabled]": {
      opacity: 1,
      cursor: "not-allowed"
    }
  };
});
var StyledChevronDownIcon = newStyled(ChevronDownIcon)(() => {
  const theme = useCustomTheme();
  return {
    color: theme.colors.secondaryText
  };
});
var safeWallet = (config) => {
  const personalWallets = (config == null ? void 0 : config.personalWallets) || defaultWallets;
  return {
    id: SafeWallet.id,
    recommended: config == null ? void 0 : config.recommended,
    meta: {
      ...SafeWallet.meta,
      iconURL: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiByeD0iMTIiIGZpbGw9IiMxMkZGODAiLz4KPG1hc2sgaWQ9Im1hc2swXzFfNDgiIHN0eWxlPSJtYXNrLXR5cGU6bHVtaW5hbmNlIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSIxMiIgeT0iMTIiIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiI+CjxwYXRoIGQ9Ik00MCA2OEM1NS40NjQgNjggNjggNTUuNDY0IDY4IDQwQzY4IDI0LjUzNiA1NS40NjQgMTIgNDAgMTJDMjQuNTM2IDEyIDEyIDI0LjUzNiAxMiA0MEMxMiA1NS40NjQgMjQuNTM2IDY4IDQwIDY4WiIgZmlsbD0id2hpdGUiLz4KPC9tYXNrPgo8ZyBtYXNrPSJ1cmwoI21hc2swXzFfNDgpIj4KPHBhdGggZD0iTTY4LjEzNzUgNy40MjY3Nkg5LjMzNzUyVjcxLjk5NDhINjguMTM3NVY3LjQyNjc2WiIgZmlsbD0iIzEyRkY4MCIvPgo8L2c+CjxwYXRoIGQ9Ik01NS42NjgzIDQwLjAwNDZINTEuODQyOUM1MC43MDA1IDQwLjAwNDYgNDkuNzc0OCA0MC45MzA5IDQ5Ljc3NDggNDIuMDcyN1Y0Ny42MjQ2QzQ5Ljc3NDggNDguNzY3IDQ4Ljg0ODYgNDkuNjkyNyA0Ny43MDY4IDQ5LjY5MjdIMzIuNDg3NkMzMS4zNDUyIDQ5LjY5MjcgMzAuNDE5NiA1MC42MTg5IDMwLjQxOTYgNTEuNzYwN1Y1NS41ODYxQzMwLjQxOTYgNTYuNzI4NSAzMS4zNDU4IDU3LjY1NDIgMzIuNDg3NiA1Ny42NTQySDQ4LjU4NzZDNDkuNzMgNTcuNjU0MiA1MC42NDM0IDU2LjcyNzkgNTAuNjQzNCA1NS41ODYxVjUyLjUxNzNDNTAuNjQzNCA1MS4zNzQ5IDUxLjU2OTYgNTAuNTY0IDUyLjcxMTUgNTAuNTY0SDU1LjY2ODNDNTYuODEwNyA1MC41NjQgNTcuNzM2NCA0OS42Mzc4IDU3LjczNjQgNDguNDk1OVY0Mi4wNDgxQzU3LjczNjQgNDAuOTA1NyA1Ni44MTAxIDQwLjAwNDEgNTUuNjY4MyA0MC4wMDQxVjQwLjAwNDZaIiBmaWxsPSIjMTIxMzEyIi8+CjxwYXRoIGQ9Ik0zMC40MjQgMzIuMzk5N0MzMC40MjQgMzEuMjU3MyAzMS4zNTAzIDMwLjMzMTYgMzIuNDkyMSAzMC4zMzE2SDQ3LjcwMTdDNDguODQ0MSAzMC4zMzE2IDQ5Ljc2OTggMjkuNDA1NCA0OS43Njk4IDI4LjI2MzZWMjQuNDM4MkM0OS43Njk4IDIzLjI5NTggNDguODQzNiAyMi4zNzAxIDQ3LjcwMTcgMjIuMzcwMUgzMS42MTA3QzMwLjQ2ODMgMjIuMzcwMSAyOS41NDI2IDIzLjI5NjQgMjkuNTQyNiAyNC40MzgyVjI3LjM4NTVDMjkuNTQyNiAyOC41Mjc5IDI4LjYxNjQgMjkuNDUzNiAyNy40NzQ1IDI5LjQ1MzZIMjQuNTMwNkMyMy4zODgyIDI5LjQ1MzYgMjIuNDYyNSAzMC4zNzk4IDIyLjQ2MjUgMzEuNTIxNlYzNy45NzYyQzIyLjQ2MjUgMzkuMTE4NiAyMy4zOTIxIDM5Ljk5NzggMjQuNTM0NSAzOS45OTc4SDI4LjM1OTlDMjkuNTAyMyAzOS45OTc4IDMwLjQyOCAzOS4wNzE2IDMwLjQyOCAzNy45Mjk3TDMwLjQyNDYgMzIuNDAwM0wzMC40MjQgMzIuMzk5N1oiIGZpbGw9IiMxMjEzMTIiLz4KPHBhdGggZD0iTTM4LjI5MjkgMzUuOTc1SDQxLjk2NzZDNDMuMTY0OSAzNS45NzUgNDQuMTM3MSAzNi45NDcxIDQ0LjEzNzEgMzguMTQ0NFY0MS44MTkxQzQ0LjEzNzEgNDMuMDE2NCA0My4xNjQ5IDQzLjk4ODYgNDEuOTY3NiA0My45ODg2SDM4LjI5MjlDMzcuMDk1NiA0My45ODg2IDM2LjEyMzUgNDMuMDE2NCAzNi4xMjM1IDQxLjgxOTFWMzguMTQ0NEMzNi4xMjM1IDM2Ljk0NzEgMzcuMDk1NiAzNS45NzUgMzguMjkyOSAzNS45NzVaIiBmaWxsPSIjMTIxMzEyIi8+Cjwvc3ZnPgo="
    },
    create: (options) => new SafeWallet({
      ...options
    }),
    connectUI(props) {
      return (0, import_jsx_runtime.jsx)(SafeConnectUI, {
        ...props,
        personalWallets
      });
    },
    isInstalled() {
      return false;
    },
    personalWallets
  };
};
var SafeConnectUI = (props) => {
  const {
    personalWalletConnection
  } = useWalletContext();
  const [personalWalletConfig, setPersonalWalletConfig] = (0, import_react.useState)();
  const disconnect = useDisconnect();
  if (personalWalletConfig) {
    const _props = {
      goBack: () => {
        personalWalletConnection.disconnectWallet();
        disconnect();
        setPersonalWalletConfig(void 0);
      },
      connected() {
        setPersonalWalletConfig(void 0);
      },
      isOpen: props.isOpen,
      hide: props.hide,
      show: props.show,
      theme: props.theme,
      walletConfig: personalWalletConfig,
      supportedWallets: props.personalWallets,
      selectionData: props.selectionData,
      setSelectionData: props.setSelectionData,
      modalSize: props.modalSize,
      connect(options) {
        return personalWalletConnection.connectWallet(personalWalletConfig, options);
      },
      setConnectedWallet(wallet) {
        personalWalletConnection.setConnectedWallet(wallet);
      },
      setConnectionStatus(status) {
        personalWalletConnection.setConnectionStatus(status);
      },
      connectionStatus: personalWalletConnection.connectionStatus,
      createWalletInstance() {
        return personalWalletConnection.createWalletInstance(personalWalletConfig);
      },
      connectedWallet: personalWalletConnection.activeWallet,
      connectedWalletAddress: personalWalletConnection.address
    };
    if (personalWalletConfig.connectUI) {
      return (0, import_jsx_runtime.jsx)(personalWalletConfig.connectUI, {
        ..._props
      });
    }
    return (0, import_jsx_runtime.jsx)(HeadlessConnectUI, {
      ..._props
    });
  }
  if (!personalWalletConnection.activeWallet) {
    return (0, import_jsx_runtime.jsx)(SelectpersonalWallet, {
      personalWallets: props.personalWallets,
      onBack: props.goBack,
      safeWallet: props.walletConfig,
      selectWallet: setPersonalWalletConfig,
      renderBackButton: props.supportedWallets.length > 1
    });
  }
  return (0, import_jsx_runtime.jsx)(SelectAccount, {
    renderBackButton: props.supportedWallets.length > 1,
    onBack: () => {
      personalWalletConnection.disconnectWallet();
      disconnect();
      props.goBack();
    },
    onConnect: props.connected,
    connect: props.connect,
    connectionStatus: props.connectionStatus,
    meta: props.walletConfig.meta
  });
};

export {
  safeWallet,
  SafeConnectUI
};
//# sourceMappingURL=chunk-YL2NSA7R.js.map
